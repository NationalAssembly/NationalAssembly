<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Tisk kartiček</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
  margin: 0;
  padding: 20px;
}
h1 {
  text-align: center;
  margin-bottom: 20px;
}
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
}
.card {
  border: 2px solid #444;
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  background: #f8f8f8;
  page-break-inside: avoid;
  display: flex;
  flex-direction: column;
  height: 360px;
  justify-content: space-between;
}
.card img {
  width: 100%;
  height: 180px;
  object-fit: contain;
  border-radius: 6px;
  background: #fff;
}
.card h2 {
  margin: 8px 0 4px;
  font-size: 18px;
}
.card .code {
  font-weight: bold;
  color: #555;
  margin-bottom: 5px;
}
.card p {
  font-size: 13px;
  text-align: center;
  overflow: hidden;
  max-height: 90px;
}
@media print {
  body { background: white; }
  .card { page-break-inside: avoid; }
}
button {
  display: block;
  margin: 0 auto 20px;
  padding: 10px 20px;
  font-size: 16px;
}
#status {
  text-align: center;
  margin-bottom: 10px;
}
</style>
</head>
<body>

<h1>Tisk kartiček</h1>
<button onclick="generatePDF()">Stáhnout PDF</button>
<div id="status">Načítám data...</div>
<div class="cards" id="cardsContainer"></div>

<script>
async function loadCards() {
  const container = document.getElementById("cardsContainer");
  try {
    const resp = await fetch("cards/data.json");
    const data = await resp.json();
    container.innerHTML = "";
    data.forEach(c => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <img src="cards/${c.image}" alt="${c.name}">
        <h2>${c.name}</h2>
        <div class="code">Kód: ${c.code}</div>
        <p>${c.description}</p>
      `;
      container.appendChild(div);
    });
    document.getElementById("status").innerText = "Kartičky načteny.";
  } catch (e) {
    document.getElementById("status").innerText = "Chyba při načítání dat.json.";
  }
}

async function generatePDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });

  const pageWidth = 210;
  const pageHeight = 297;
  const cardWidth = 65;
  const cardHeight = 90;
  const margin = 10;

  try {
    const response = await fetch("cards/data.json");
    const cards = await response.json();

    let x = margin, y = margin;

    for (let i = 0; i < cards.length; i++) {
      const c = cards[i];
      const img = await toDataURL(`cards/${c.image}`);

      pdf.setDrawColor(0);
      pdf.setLineWidth(0.5);
      pdf.rect(x, y, cardWidth, cardHeight);

      // Obrázek s poměrem stran
      pdf.addImage(img, "JPEG", x + 2, y + 2, cardWidth - 4, 35, null, 'FAST');

      // Název
      pdf.setFontSize(12);
      pdf.text(c.name, x + 4, y + 42);

      // Kód
      pdf.setFontSize(10);
      pdf.text(`Kód: ${c.code}`, x + 4, y + 48);

      // Popis – zalomení
      pdf.setFontSize(9);
      const desc = pdf.splitTextToSize(c.description, cardWidth - 8);
      const maxLines = 6;
      const trimmedDesc = desc.slice(0, maxLines);
      pdf.text(trimmedDesc, x + 4, y + 54);

      // Posun na další kartičku
      x += cardWidth + margin;
      if (x + cardWidth > pageWidth) {
        x = margin;
        y += cardHeight + margin;
        if (y + cardHeight > pageHeight) {
          pdf.addPage();
          y = margin;
        }
      }
    }

    pdf.save("karticky.pdf");
    document.getElementById("status").textContent = "PDF vygenerováno!";
  } catch (err) {
    console.error(err);
    document.getElementById("status").innerText = "Chyba při vytváření PDF.";
  }
}

function toDataURL(url) {
  return fetch(url)
    .then(resp => resp.blob())
    .then(blob => new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(blob);
    }));
}

loadCards();
</script>

</body>
</html>
