<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Simulátor kostelní komunity</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f4f8; margin: 0; padding: 20px; }
h1 { text-align: center; color: #4b0082; }
.container { max-width: 1000px; margin: 0 auto; }
.card-grid { display: flex; flex-wrap: wrap; gap: 10px; }
.person-card { width: 100px; text-align: center; border: 2px solid #ccc; border-radius: 8px; padding: 5px; background: #fff; cursor: pointer; }
.person-card.selected { border-color: #800080; background: #e0c8ff; }
.person-card img { width: 80px; height: 80px; border-radius: 50%; }
.message { background: #d0e8ff; padding: 8px; margin: 10px 0; border-radius: 5px; }
.input-group { margin: 10px 0; }
input[type=text] { padding: 5px; font-size: 16px; width: 150px; text-transform: uppercase; }
button { padding: 6px 10px; margin-left: 5px; }
.details { background: #fff0ff; padding: 10px; margin-top: 10px; border-radius: 8px; }
.stats { display: flex; justify-content: space-around; margin: 10px 0; padding: 10px; background: #fff; border-radius: 8px; }
.stats div { text-align: center; }
</style>
</head>
<body>
<div class="container">
  <h1>⛪ Simulátor kostelní komunity</h1>

  <div class="stats" id="communityStats"></div>

  <div class="input-group">
    <label>Zadejte kód kartičky: </label>
    <input type="text" id="codeInput" maxlength="6" placeholder="###XXX">
    <button id="kontrola" onclick="checkCode()">Zkontrolovat</button>
    <button onclick="useCode()">Použít kód</button>
  </div>

  <div id="message" class="message"></div>

  <div class="card-grid" id="communityGrid"></div>

  <div id="personDetails" class="details"></div>
</div>

<script>
// Startovní zdroje
let resources = { víra: 20, radost: 20, peníze: 10, vztah: 5, znalost: 5 };
let turn = 1;
let timeLeft = 60;
let vyuzito=[];
let cardsData = [];
let runtime=60;
let interval=1000;
let Cturn=0
fetch('cards/data.json')
  .then(resp => resp.json())
  .then(data => {
    cardsData = data;
    initCommunity();
    updateStats();
  })
  .catch(err => alert("Nepodařilo se načíst data.json"));

const peopleCount = 16;
let community = [];
let selectedPerson = null;
let decodedCard = null;

function initCommunity() {
  community = [];
  for(let i=0;i<peopleCount;i++){
    community.push({
      id: i,
      card: { 
        name: "Student", 
        image: "student.png", 
        produces: { víra: 1, radost: 1, znalost: 1 }, 
        costs: {}, 
        traits: {}, 
        description: "Všichni jsou někdy studenti." 
      }
    });
  }
  renderCommunity();
}

let gameInterval = setInterval(() => {
  timeLeft--;
  if (timeLeft <= 0) {
    runTurn();
    timeLeft = runtime;
    turn++;
  }
  updateStats();
}, interval);


function runTurn(){
  community.forEach(p=>{
    let canWork = true;
    if(p.card.costs){
      for(let k in p.card.costs){
        if(resources[k] < p.card.costs[k]) canWork = false;
      }
    }
    if(canWork){
      for(let k in p.card.costs) resources[k] -= p.card.costs[k];
      for(let k in p.card.produces){
        resources[k] = (resources[k] || 0) + p.card.produces[k];
      }
    }
  });
}

function updateStats(){
  const statsDiv = document.getElementById("communityStats");
  statsDiv.innerHTML = `
    <div>Víra: ${Math.floor(resources.víra)}</div>
    <div>Radost: ${Math.floor(resources.radost)}</div>
    <div>Peníze: ${Math.floor(resources.peníze)}</div>
    <div>PR: ${Math.floor(resources.vztah)}</div>
    <div>Znalost: ${Math.floor(resources.znalost)}</div>
    <div>Kolo: ${turn}</div>
    <div>Čas: ${timeLeft}</div>
  `;
}

function renderCommunity(){
  const grid = document.getElementById("communityGrid");
  grid.innerHTML = "";
  community.forEach(p=>{
    const div = document.createElement("div");
    div.className = "person-card" + (selectedPerson === p.id ? " selected" : "");
    div.onclick = ()=>{ selectedPerson = p.id; renderCommunity(); showDetails(p.id); }
    div.innerHTML = `
      <img src="cards/${p.card.image}" alt="${p.card.name}">
      <div>${p.card.name}</div>
    `;
    grid.appendChild(div);
  });
}

function checkCode(){
  const code = document.getElementById("codeInput").value.trim().toUpperCase();
  decodedCard = cardsData.find(c=>c.code === code);
  const msg = document.getElementById("message");
  
if (Cturn>0 && turn-Cturn>=100 ){
    interval=99999999999999
timeLeft=999999999;
}

if (code === "WW$WW") {
  clearInterval(gameInterval);
  Cturn = turn;
  msg.innerText = "⚡ Režim rychlého běhu aktivován!";

  gameInterval = setInterval(() => {
    runTurn();
    updateStats();
    turn++;

    // kontrola konce po 100 kolech
    if (Cturn > 0 && turn - Cturn >= 100) {
      clearInterval(gameInterval);
      msg.innerText = "✅ Konec hry!";
        document.getElementById("kontrola").style.display = "none";

    }

  }, 100); // každých 0.1 sekundy = rychlý běh

  return;
}
  
  if(!code || code.length !== 6){
    decodedCard = null;
    msg.innerText = "❌ Kód musí mít přesně 6 znaků!";
  } else if(!decodedCard){
    msg.innerText = "❌ Neplatný kód!";
  } else {
    msg.innerText = `✅ Kód platný! Kartička: ${decodedCard.name}`;
  }
}

function useCode(){
  const msg = document.getElementById("message");
  if(decodedCard===null){
    msg.innerText = "❌ Nejprve zkontrolujte kód!";
    return;
  }
  if(selectedPerson===null){
    msg.innerText = "❌ Vyberte osobu!";
    return;
  }
    if(vyuzito.includes(decodedCard)){
    msg.innerText = "❌ Každá karta může být využita maximálně jednou!";
    return;
  }
  community[selectedPerson].card = decodedCard;
  msg.innerText = `✅ Osoba ${selectedPerson+1} se změnila na ${decodedCard.name}`;
  vyuzito.push(decodedCard)
  renderCommunity();
  showDetails(selectedPerson);
  decodedCard = null;
  document.getElementById("codeInput").value = "";
}

function showDetails(personId){
  const details = document.getElementById("personDetails");
  const card = community[personId].card;
  details.innerHTML = `
    <h3>Osoba ${personId+1} - ${card.name}</h3>
    <p>${card.description}</p>
    <p><strong>Produkuje:</strong> ${Object.entries(card.produces).map(([k,v])=>`${k === 'vztah' ? 'PR' : k}: +${v}`).join(', ') || '-'}</p>
    <p><strong>Stojí:</strong> ${Object.entries(card.costs).map(([k,v])=>`${k === 'vztah' ? 'PR' : k}: ${v}`).join(', ') || '-'}</p>
    <p><strong>Vlastnosti:</strong> ${Object.entries(card.traits).map(([k,v])=>`${k}: ${v}`).join(', ') || '-'}</p>
  `;
}
</script>

</body>
</html>
